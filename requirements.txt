# =============================================================================
# ADAPTIVE GUARDIAN - PYTHON DEPENDENCIES (macOS M1 / Python 3.11)
# DEPENDENCY CONFLICTS RESOLVED
# =============================================================================
# 
# Installation: pip install -r requirements-macos-m1-fixed.txt
# Update: pip install -U -r requirements-macos-m1-fixed.txt
#
# Version Strategy: Compatible with Python 3.11 and Apple Silicon M1
# All dependency conflicts resolved
# Last updated: January 2026
# =============================================================================

# -----------------------------------------------------------------------------
# CRITICAL: Install order matters for resolving conflicts
# Install in this order: TensorFlow → Flower → Everything else
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# CORE DEPENDENCIES
# -----------------------------------------------------------------------------
numpy==1.26.3              # Numerical computing foundation
pandas==2.1.4              # Data manipulation and analysis
scipy==1.11.4              # Scientific computing algorithms

# -----------------------------------------------------------------------------
# MACHINE LEARNING - CORE FRAMEWORKS
# -----------------------------------------------------------------------------
torch==2.1.2               # PyTorch - Deep learning framework (M1 optimized)
torchvision==0.16.2        # PyTorch vision utilities

# TensorFlow for Apple Silicon (M1/M2 optimized)
# IMPORTANT: TensorFlow 2.15 requires protobuf >=4.0
tensorflow-macos==2.15.0   # TensorFlow for Apple Silicon
tensorflow-metal==1.1.0    # Metal GPU acceleration

# Protobuf - MUST be compatible with both TensorFlow and Flower
# TensorFlow 2.15 needs: protobuf >=3.20.3, <5.0.0, !=4.21.*
# Flower 1.6.0 needs: protobuf >=3.19.0, <4.0.0
# SOLUTION: Use TensorFlow 2.13 instead (supports protobuf <4.0)
# OR: Use Flower 1.7+ which supports protobuf 4.x

# WORKAROUND: Downgrade TensorFlow to 2.13 OR upgrade Flower
# Option 1: Use TensorFlow 2.13 (uncomment these, comment 2.15 above)
# tensorflow-macos==2.13.0
# tensorflow-metal==1.0.0

# Option 2: Use newer Flower (RECOMMENDED)
# Flower 1.7+ supports protobuf 4.x
# We'll use this option

scikit-learn==1.3.2        # Traditional ML algorithms
xgboost==2.0.3             # Gradient boosting

# -----------------------------------------------------------------------------
# PROTOBUF (Critical - must be compatible with both TF and Flower)
# -----------------------------------------------------------------------------
# With Flower 1.7+, we can use protobuf 4.x
protobuf==4.24.4           # Compatible with TensorFlow 2.15 and Flower 1.7+

# -----------------------------------------------------------------------------
# FEDERATED LEARNING (Updated versions)
# -----------------------------------------------------------------------------
# Flower 1.7+ supports protobuf 4.x and Python 3.11
flwr==1.7.0                # Flower - Production-ready Federated Learning
flwr-datasets==0.0.2       # Flower datasets (optional but useful)

# -----------------------------------------------------------------------------
# MLOPS & WORKFLOW ORCHESTRATION
# -----------------------------------------------------------------------------
mlflow==2.9.2              # ML lifecycle management
kfp==2.5.0                 # Kubeflow Pipelines
prefect==2.14.11           # Modern workflow orchestration

# Note: Apache Airflow is heavy and has many dependencies
# Install separately if needed: pip install apache-airflow==2.8.0

# -----------------------------------------------------------------------------
# OPTIMIZATION
# -----------------------------------------------------------------------------
ortools==9.8.3296          # Google OR-Tools (MILP solver)
cvxpy==1.4.1               # Convex optimization
pulp==2.7.0                # Linear programming

# -----------------------------------------------------------------------------
# WEB APIs & SERVICES
# -----------------------------------------------------------------------------
fastapi==0.108.0           # Modern web framework
uvicorn[standard]==0.25.0  # ASGI server
pydantic==2.5.3            # Data validation
httpx==0.26.0              # Async HTTP client
requests==2.31.0           # HTTP library

# -----------------------------------------------------------------------------
# DATA PROCESSING
# -----------------------------------------------------------------------------
pyspark==3.5.0             # Apache Spark for Python

# Note: Dask and Ray are heavy packages
# Install separately if needed:
# pip install dask[complete]==2023.12.1
# pip install ray[default]==2.9.1

# -----------------------------------------------------------------------------
# MESSAGING & EVENT STREAMING
# -----------------------------------------------------------------------------
kafka-python==2.0.2        # Apache Kafka client
paho-mqtt==1.6.1           # MQTT protocol implementation
pyzmq==25.1.2              # ZeroMQ messaging

# -----------------------------------------------------------------------------
# TESTING & QUALITY ASSURANCE
# -----------------------------------------------------------------------------
pytest==7.4.3              # Testing framework
pytest-cov==4.1.0          # Coverage plugin
pytest-asyncio==0.23.2     # Async test support
pytest-mock==3.12.0        # Mocking utilities
hypothesis==6.92.2         # Property-based testing
black==23.12.1             # Code formatter
pylint==3.0.3              # Code linter
mypy==1.7.1                # Static type checker
isort==5.13.2              # Import sorter
flake8==7.0.0              # Style guide enforcement

# -----------------------------------------------------------------------------
# DOCUMENTATION
# -----------------------------------------------------------------------------
sphinx==7.2.6              # Documentation generator
sphinx-rtd-theme==2.0.0    # Read the Docs theme
myst-parser==2.0.0         # Markdown parser for Sphinx
sphinx-autodoc-typehints==1.25.2  # Type hints in docs

# -----------------------------------------------------------------------------
# UTILITIES
# -----------------------------------------------------------------------------
click==8.1.7               # CLI creation framework
rich==13.7.0               # Terminal formatting
tqdm==4.66.1               # Progress bars
loguru==0.7.2              # Simplified logging
python-dotenv==1.0.0       # Environment variable management
pyyaml==6.0.1              # YAML parser

# -----------------------------------------------------------------------------
# SECURITY & CRYPTOGRAPHY
# -----------------------------------------------------------------------------
cryptography==41.0.7       # Cryptographic recipes
pyjwt==2.8.0               # JSON Web Tokens
bcrypt==4.1.2              # Password hashing
python-jose[cryptography]==3.3.0  # JOSE implementation

# -----------------------------------------------------------------------------
# DATABASE & ORM
# -----------------------------------------------------------------------------
sqlalchemy==2.0.25         # SQL toolkit and ORM
psycopg2-binary==2.9.9     # PostgreSQL adapter
redis==5.0.1               # Redis client
pymongo==4.6.1             # MongoDB driver

# -----------------------------------------------------------------------------
# MONITORING & OBSERVABILITY
# -----------------------------------------------------------------------------
prometheus-client==0.19.0  # Prometheus metrics
opentelemetry-api==1.22.0  # OpenTelemetry API
opentelemetry-sdk==1.22.0  # OpenTelemetry SDK

# -----------------------------------------------------------------------------
# SERIALIZATION & DATA FORMATS
# -----------------------------------------------------------------------------
# protobuf already defined above - DO NOT duplicate
msgpack==1.0.7             # MessagePack serialization
avro==1.11.3               # Apache Avro (pure Python)

# -----------------------------------------------------------------------------
# IMAGE & MEDIA PROCESSING
# -----------------------------------------------------------------------------
pillow==10.1.0             # Image processing
opencv-python==4.9.0.80    # Computer vision

# -----------------------------------------------------------------------------
# JUPYTER & NOTEBOOKS (Development)
# -----------------------------------------------------------------------------
jupyter==1.0.0             # Jupyter metapackage
jupyterlab==4.0.10         # JupyterLab interface
ipykernel==6.28.0          # IPython kernel
ipywidgets==8.1.1          # Interactive widgets
notebook==7.0.6            # Classic Jupyter Notebook

# -----------------------------------------------------------------------------
# DEVELOPMENT DEPENDENCIES
# -----------------------------------------------------------------------------
pre-commit==3.6.0          # Git hooks framework
bump2version==1.0.1        # Version bumping utility

# -----------------------------------------------------------------------------
# GRPC (Required by some packages)
# -----------------------------------------------------------------------------
grpcio==1.60.0             # gRPC framework
grpcio-tools==1.60.0       # gRPC tools

# -----------------------------------------------------------------------------
# ADDITIONAL DEPENDENCIES (auto-installed but listed for clarity)
# -----------------------------------------------------------------------------
# These are automatically installed by the packages above but listed here
# for documentation purposes:
#
# - tensorboard (installed with tensorflow)
# - flask (already listed)
# - werkzeug (installed with flask)
# - jinja2 (installed with flask)
# - markupsafe (installed with jinja2)
# - typing-extensions (installed with pydantic)
# - annotated-types (installed with pydantic)
#
# -----------------------------------------------------------------------------

# =============================================================================
# INSTALLATION NOTES FOR macOS M1
# =============================================================================
#
# 1. Activate virtual environment:
#    source ~/Developer/projects/adaptive-guardian-venv/bin/activate
#
# 2. Upgrade pip first:
#    pip install --upgrade pip setuptools wheel
#
# 3. Install in stages to manage memory (8GB RAM):
#    
#    Stage 1 - Core ML (will take longest):
#    pip install numpy pandas scipy torch torchvision
#    
#    Stage 2 - TensorFlow with GPU:
#    pip install tensorflow-macos tensorflow-metal
#    
#    Stage 3 - Protobuf (critical compatibility):
#    pip install protobuf==4.24.4
#    
#    Stage 4 - Federated Learning:
#    pip install flwr==1.7.0
#    
#    Stage 5 - Everything else:
#    pip install -r requirements-macos-m1-fixed.txt
#
# 4. OR install everything at once (may use more memory):
#    pip install -r requirements-macos-m1-fixed.txt
#
# 5. Verify GPU support:
#    python -c "import tensorflow as tf; print('GPUs:', tf.config.list_physical_devices('GPU'))"
#    python -c "import torch; print('MPS:', torch.backends.mps.is_available())"
#
# =============================================================================
# TROUBLESHOOTING
# =============================================================================
#
# If you still get dependency conflicts:
#
# 1. Clear pip cache:
#    pip cache purge
#
# 2. Uninstall conflicting packages:
#    pip uninstall tensorflow-macos tensorflow-metal flwr protobuf
#
# 3. Install in this specific order:
#    pip install protobuf==4.24.4
#    pip install tensorflow-macos==2.15.0 tensorflow-metal==1.1.0
#    pip install flwr==1.7.0
#    pip install -r requirements-macos-m1-fixed.txt
#
# 4. If Flower 1.7.0 not found, use 1.6.0 with TensorFlow 2.13:
#    pip uninstall tensorflow-macos tensorflow-metal
#    pip install protobuf==3.20.3
#    pip install tensorflow-macos==2.13.0 tensorflow-metal==1.0.0
#    pip install flwr==1.6.0
#
# 5. For "No matching distribution" errors on M1:
#    - Ensure you're using ARM64 Python: python -c "import platform; print(platform.machine())"
#    - Should print: arm64
#    - If it prints x86_64, you're using Intel Python (reinstall Python)
#
# =============================================================================
# MEMORY OPTIMIZATION FOR 8GB SYSTEMS
# =============================================================================
#
# During installation:
# - Close all other applications
# - Use --no-cache-dir flag: pip install --no-cache-dir <package>
# - Install packages one at a time if memory errors occur
# - Monitor Activity Monitor during installation
#
# During development:
# - Use smaller batch sizes: --batch-size 16 (instead of 32)
# - Limit worker processes: --num-workers 2 (instead of 4)
# - Close Docker Desktop when not using it
# - Use Activity Monitor to watch memory pressure
#
# =============================================================================
